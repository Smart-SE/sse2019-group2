[{"id":"a4fefb1.8065a08","type":"tab","label":"Result画面","disabled":false,"info":""},{"id":"bf8a55f2.867448","type":"http in","z":"a4fefb1.8065a08","name":"","url":"select","method":"get","upload":false,"swaggerDoc":"","x":107.5,"y":499.5,"wires":[["81da27d8.f0d798"]]},{"id":"c826e56d.1effe8","type":"http response","z":"a4fefb1.8065a08","name":"","statusCode":"","headers":{},"x":516.5,"y":494,"wires":[]},{"id":"81da27d8.f0d798","type":"template","z":"a4fefb1.8065a08","name":"select","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n<head>\n<title>Countries & Capitals</title>\n <meta charset=\"utf-8\"> \n <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n <meta name=\"apple-mobile-web-app-capable\" content=\"yes\">\n <meta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\">\n <meta name=\"apple-mobile-web-app-title\" content=\"Node-RED\">\n <meta name=\"mobile-web-app-capable\" content=\"yes\">\n <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n <link rel=\"manifest\" href=\"manifest.json\">\n <link rel=\"icon\" sizes=\"192x192\" href=\"icon192x192.png\">\n <link rel=\"shortcut icon\" type=\"image/png\" href=\"icon64x64.png\">\n <link rel=\"apple-touch-icon\" href=\"icon120x120.png\">\n <link rel=\"stylesheet\" href=\"ui/css/app.min.css\">\n <link rel=\"stylesheet/less\" href=\"ui/css/app.min.less\"\n\n<style>\n    {{{css.cssfile1}}}\n</style>\n<script src='//code.jquery.com/jquery-2.2.4.min.js'></script>\n<script>\n$(function(){\n  $('#myform').submit( function(){\n    $.ajax({\n      type: 'POST',\n      url: '/myrecord',\n      data: { country: $('#country').val(), capital: $('#capital').val() },\n      success: function( data ){\n        console.log( data );\n        setTimeout( 'list()', 1000 );\n      },\n      error: function(){\n        console.log( 'error' );\n      }\n    });\n    return false;\n  });\n  list();\n});\nfunction list(){\n  $('#list').html( '' );\n  $.ajax({\n    type: 'GET',\n    url: '/myrecords',\n    success: function( data ){\n      if( data && data.length > 0 ){\n        for( var i = 0; i < data.length; i ++ ){\n          var doc = data[i];\n          var tr = '<tr><td>' + doc.country + '</td><td>' + doc.capital + '</td></tr>';\n          $('#list').append( tr );\n        }\n      }\n    },\n    error: function(){\n      console.log( 'error' );\n    }\n  });\n}\n</script>\n</head>\n<body>\n<div>\n　　<label> <input ng-click=\"send({payload:model_a})\" type=\"radio\" ng-model=\"model_a\" name=\"model_c\" value=\"1\" class=\"radio1\">\n       <img src=\"pict\\a.png\" class=\"radio_image\" width=\"100\" height=\"100\">\n    </label>\n    <label> <input ng-click=\"send({payload:model_a})\" type=\"radio\" ng-model=\"model_a\" name=\"model_c\" value=\"2\" class=\"radio1\">\n       <img src=\"pict\\b.png\" class=\"radio_image\" width=\"100\" height=\"100\">\n    </label>\n    <br> \n　　<label> <input ng-click=\"send({payload:model_a})\" type=\"radio\" ng-model=\"model_a\" name=\"model_c\" value=\"3\" class=\"radio1\">\n       <img src=\"pict\\c.png\" class=\"radio_image\" width=\"100\" height=\"100\">\n    </label>\n    <label> <input ng-click=\"send({payload:model_a})\" type=\"radio\" ng-model=\"model_a\" name=\"model_c\" value=\"4\" class=\"radio1\">\n       <img src=\"pict\\d.png\" class=\"radio_image\" width=\"100\" height=\"100\">\n    </label>\n</div>\n  <table border='1'>\n  <thead>\n  <tr><th>Country</th><th>Capital</th><tr>\n  </thead>\n  <tbody id='list'>\n  </tbody>\n</table>\n<hr/>\n\n<form method='POST' id='myform'>\n  Country: <input type='text' id='country' name='country' value=''/><br/>\n  Capital: <input type='text' id='capital' name=\"capital\" value=''/><br/>\n  <input type='submit' value='click'/>\n</form>\n</body>\n</html>\n</style>\n","output":"str","x":311.5,"y":497.5,"wires":[["c826e56d.1effe8"]]},{"id":"303ae4f2.37870c","type":"ui_template","z":"a4fefb1.8065a08","group":"4b2a9770.4bb308","name":"チャート","order":3,"width":"0","height":"0","format":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <script src=\"http://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n    <script>\n        // 2) CSVから２次元配列に変換\n        function csv2Array(str) {\n          var csvData = [];\n          var lines = str.split(\"\\n\");\n          for (var i = 0; i < lines.length; ++i) {\n            var cells = lines[i].split(\",\");\n            csvData.push(cells);\n          }\n          return csvData;\n        }\n\n        function drawBarChart(data) {\n          // 3)chart.jsのdataset用の配列を用意\n          var tmpLabels = [], tmpData1 = [], tmpData2 = [];\n          for (var row in data) {\n            tmpLabels.push(data[row][0])\n            tmpData1.push(data[row][1])\n            tmpData2.push(data[row][2])\n          };\n\n          // 4)chart.jsで描画\n          var ctx = document.getElementById(\"myChart\").getContext(\"2d\");\n          var myChart = new Chart(ctx, {\n            type: 'bar',\n            data: {\n              labels: tmpLabels,\n              datasets: [\n                { label: \"Count\", data: tmpData1, backgroundColor: \"red\" },\n                { label: \"Score\", data: tmpData2, backgroundColor: \"blue\" }\n              ]\n            }\n          });\n        }\n\n        function main() {\n          // 1) ajaxでCSVファイルをロード\n          var req = new XMLHttpRequest();\n//          var filePath = '/home/pi/development/k1_iot/test4.csv';\n          var filePath = '';\n          req.open(\"GET\", filePath, true);\n          req.onload = function() {\n            // 2) CSVデータ変換の呼び出し\n            data = csv2Array(req.responseText);\n            // 3) chart.jsデータ準備、4) chart.js描画の呼び出し\n            drawBarChart(data);\n          }\n          req.send(null);\n        }\n\n        main();\n    </script>\n\n    <title>chart of results</title>\n</head>\n<body>\n<!--ここにグラフが挿入されます-->\n<div style=\"width: 100%; height: 100%;\">\n    <canvas id=\"myChart\" style=\"width: 100%; height: auto;\"></canvas>\n</div>\n</body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":463,"y":79,"wires":[[]]},{"id":"45e6e886.3a18e8","type":"ui_ui_control","z":"a4fefb1.8065a08","name":"","x":474.0000534057617,"y":333.0000114440918,"wires":[[]]},{"id":"6e463262.b2ef5c","type":"template","z":"a4fefb1.8065a08","name":"開始画面へ","field":"payload","fieldType":"msg","format":"json","syntax":"plain","template":"{\n    \"tab\": \"select_music\",\n    \"group\": {\n        \"show\": [\n\n        ]\n    }\n}","output":"json","x":291.0035629272461,"y":332.4235954284668,"wires":[["45e6e886.3a18e8"]]},{"id":"9f296769.742718","type":"ui_button","z":"a4fefb1.8065a08","name":"","group":"4b2a9770.4bb308","order":4,"width":0,"height":0,"passthru":true,"label":"楽曲選択へ","tooltip":"","color":"","bgcolor":"","icon":"","payload":"0","payloadType":"num","topic":"","x":94.99999237060547,"y":331.9235954284668,"wires":[["6e463262.b2ef5c"]]},{"id":"3bbfbd54.c02da2","type":"template","z":"a4fefb1.8065a08","name":"読み込みファイル","field":"filename","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"C:\\smartse\\csv\\test.csv","output":"str","x":107,"y":81,"wires":[["aef12df1.94efc"]]},{"id":"aef12df1.94efc","type":"template","z":"a4fefb1.8065a08","name":"","field":"js.javascriptfile1","fieldType":"msg","format":"javascript","syntax":"mustache","template":"// 2) CSVから２次元配列に変換\nfunction csv2Array(str) {\n  var csvData = [];\n  var lines = str.split(\"\\n\");\n  for (var i = 0; i < lines.length; ++i) {\n    var cells = lines[i].split(\",\");\n    csvData.push(cells);\n  }\n  return csvData;\n}\n\nfunction drawBarChart(data) {\n  // 3)chart.jsのdataset用の配列を用意\n  var tmpLabels = [], tmpData1 = [], tmpData2 = [];\n  for (var row in data) {\n    tmpLabels.push(data[row][0])\n    tmpData1.push(data[row][1])\n    tmpData2.push(data[row][2])\n  }\n\n  // 4)chart.jsで描画\n  var ctx = document.getElementById(\"myChart\").getContext(\"2d\");\n  var myChart = new Chart(ctx, {\n    type: 'bar',\n    data: {\n      labels: tmpLabels,\n      datasets: [\n        { label: \"Count\", data: tmpData1, backgroundColor: \"red\" },\n        { label: \"Score\", data: tmpData2, backgroundColor: \"blue\" }\n      ]\n    }\n  });\n}\n\nfunction main() {\n  // 1) ajaxでCSVファイルをロード\n  var req = new XMLHttpRequest();\n//  var filePath = '/home/pi/development/k1_iot/test4.csv';\n  var filePath = 'C:\\smartse\\csv\\test.csv';\n  req.open(\"GET\", filePath, true);\n  req.onload = function() {\n    // 2) CSVデータ変換の呼び出し\n    data = csv2Array(req.responseText);\n    // 3) chart.jsデータ準備、4) chart.js描画の呼び出し\n    drawBarChart(data);\n  }\n  req.send(null);\n}\n\nmain();","output":"str","x":292,"y":79.5,"wires":[["303ae4f2.37870c"]]},{"id":"da21c90e.ce17d8","type":"csv to json ext","z":"a4fefb1.8065a08","name":"","version":"0.1","source":"filename","delimiter":",","quote":"\"","escape":"\"","ignoreEmpty":false,"checkType":false,"trim":false,"noheader":false,"includeColumns":"","headers":"","debug":false,"x":-124.4340410232544,"y":319.95833253860474,"wires":[[]]},{"id":"842819e5.63ba98","type":"csv to json ext","z":"a4fefb1.8065a08","name":"","version":"0.1","source":"filename","delimiter":",","quote":"\"","escape":"\"","ignoreEmpty":false,"checkType":false,"trim":false,"noheader":false,"includeColumns":"","headers":"","debug":false,"x":-124.4340410232544,"y":319.95833253860474,"wires":[[]]},{"id":"4e3d72cd.908dac","type":"csv to json ext","z":"a4fefb1.8065a08","name":"","version":"0.1","source":"filename","delimiter":",","quote":"\"","escape":"\"","ignoreEmpty":false,"checkType":false,"trim":false,"noheader":false,"includeColumns":"","headers":"","debug":false,"x":-124.4340410232544,"y":319.95833253860474,"wires":[[]]},{"id":"be2338e8.ae4a78","type":"csv to json ext","z":"a4fefb1.8065a08","name":"","version":"0.1","source":"filename","delimiter":",","quote":"\"","escape":"\"","ignoreEmpty":false,"checkType":false,"trim":false,"noheader":false,"includeColumns":"","headers":"","debug":false,"x":-124.4340410232544,"y":319.95833253860474,"wires":[[]]},{"id":"63314f03.6ed1c","type":"csv to json ext","z":"a4fefb1.8065a08","name":"","version":"0.1","source":"filename","delimiter":",","quote":"\"","escape":"\"","ignoreEmpty":false,"checkType":false,"trim":false,"noheader":false,"includeColumns":"","headers":"","debug":false,"x":-124.4340410232544,"y":471.6250500679016,"wires":[[]]},{"id":"14995c10.c47e64","type":"ui_gauge","z":"a4fefb1.8065a08","name":"成績","group":"4b2a9770.4bb308","order":2,"width":0,"height":0,"gtype":"wave","title":"今回の成績","label":"点","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":457.5642738342285,"y":192.91666221618652,"wires":[]},{"id":"a68f8925.3b5208","type":"inject","z":"a4fefb1.8065a08","name":"","topic":"","payload":"80","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":89.5625,"y":191.98090934753418,"wires":[["12fb039.1142efc"]]},{"id":"12fb039.1142efc","type":"function","z":"a4fefb1.8065a08","name":"dummy","func":"return msg;","outputs":1,"noerr":0,"x":280.56596755981445,"y":193.78646850585938,"wires":[["14995c10.c47e64"]]},{"id":"4b2a9770.4bb308","type":"ui_group","z":"","name":"Reslt","tab":"7919325a.5d6e3c","disp":true,"width":"6","collapse":false},{"id":"7919325a.5d6e3c","type":"ui_tab","z":"","name":"Result","icon":"dashboard","order":2,"disabled":false,"hidden":false}]